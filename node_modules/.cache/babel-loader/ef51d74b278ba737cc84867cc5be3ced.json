{"ast":null,"code":"import _toConsumableArray from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Container}from\"unstated\";import instance from\"../helpers/axiosly\";import CONSTANTS from\"../helpers/App.constant\";import{userRoutes,authRoutes,superadminRoutes}from\"../routes/allRoutes\";import{LOCAL_STORAGE_SIGNIN_KEY,isCompletedExam}from'../App.constants';import{ROLES}from'../App.constants';var UserContainer=/*#__PURE__*/function(_Container){_inherits(UserContainer,_Container);var _super=_createSuper(UserContainer);function UserContainer(){var _this;_classCallCheck(this,UserContainer);_this=_super.call(this);_this.goBack=function(props){props.history.goBack();};_this.fetchUser=function(){// copySessionData = ({}, this.state.sessionData);\n// copySessionData.userId = user.id;\n// console.log(\"new user id\", { sessionData: copySessionData });\nvar user;if(!localStorage.getItem('authUser')){user=localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);}else user=localStorage.getItem('authUser');if(user){user=JSON.parse(user);//   console.log(\"check access token\",user.access_token);\n//   copySessionData.accessToken = user.access_token;\n//   copySessionData.userId = user.id;\n//   this.setState({ sessionData: copySessionData });\n//   console.log(\"check access token\", copySessionData);\n// console.log(\"check authuser from fetch :\", user);\n_this.setState({sessionData:{user:user,accessToken:\"\".concat(user.access_token),userId:user.id}});return user;}return{};};_this.findWriterExam=function(userId,bearertoken){return new Promise(function(resolve,reject){instance.get(\"\".concat(process.env.REACT_APP_DATABASEURL,\"exam/user/\").concat(userId),{// {userId: userId},\nheaders:{Authorization:\"Bearer \".concat(bearertoken)}}).then(function(response){console.log(resolve(response===null||response===void 0?void 0:response.data));resolve(response===null||response===void 0?void 0:response.data);}).catch(function(e){var _e$response,_e$response2;console.log(e);console.log(e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:_e$response.data);console.log(e===null||e===void 0?void 0:e.response);resolve(e===null||e===void 0?void 0:(_e$response2=e.response)===null||_e$response2===void 0?void 0:_e$response2.data);});});};_this.init=function(){try{var writerDom=localStorage.getItem(isCompletedExam);if(writerDom=='true'){_this.setState({writerDom:true});}else{_this.setState({writerDom:false});}}catch(e){_this.setState({writerDom:false});}};_this.signIn=function(_ref,props){var email=_ref.email,password=_ref.password;instance.post(\"\".concat(process.env.REACT_APP_DATABASEURL,\"/auth/login\"),{email:email,password:password}).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(response){var user,Authuser,writerExamStatus;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:user=response.data.data;console.log(user);console.log(\"check base url \",process.env.REACT_APP_DATABASEURL);localStorage.setItem(LOCAL_STORAGE_SIGNIN_KEY,JSON.stringify(response.data.data));_this.setState({sessionData:{user:user,// accessToken: `${user.access_token}`,\nuserId:user.id}});Authuser=JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));if(Authuser.subRole===\"Super-admin\"){localStorage.setItem(\"users\",Authuser.subRole);}else{localStorage.setItem(\"users\",Authuser.Role.role);}localStorage.setItem(\"token\",Authuser.access_token);//check if writer has a score and redirect\n/*async function fetchData(){\n          try {\n            const res = await instance\n              .get(`${process.env.REACT_APP_DATABASEURL}/exam/user/${Authuser.id}`, {\n                headers: {\n                  Authorization: `Bearer ${Authuser.access_token}`,\n                },\n              })\n\n              if(res.data.data.score){\n                this.setState({\n                  sessionData: {\n                    score: res.data.data.score\n                  },})\n              }\n\n          } catch (e) {\n            console.log(e);\n          }\n          }\n          fetchData();*/if(!(Authuser.Role.role==='Client')){_context.next=13;break;}localStorage.setItem(\"User\",'Client');props.history.push(\"/dashboard\");_context.next=31;break;case 13:if(!(Authuser.subRole==='Super-admin')){_context.next=18;break;}localStorage.setItem(\"SuperAdmin\",'SuperAdmin');props.history.push(\"/admin-dashboard\");_context.next=31;break;case 18:if(!(Authuser.Role.role==='Admin')){_context.next=23;break;}localStorage.setItem(\"Admin\",'Admin');props.history.push(\"/admindashboard\");_context.next=31;break;case 23:if(!(Authuser.Role.role==='Writer')){_context.next=31;break;}localStorage.setItem(\"Writer\",'Writer');console.log(user);_context.next=28;return _this.findWriterExam(user===null||user===void 0?void 0:user.id,user===null||user===void 0?void 0:user.access_token);case 28:writerExamStatus=_context.sent;console.log(writerExamStatus===null||writerExamStatus===void 0?void 0:writerExamStatus.status,\"status of exam\");if((writerExamStatus===null||writerExamStatus===void 0?void 0:writerExamStatus.status)=='Success'){_this.setState({writerDom:true},function(){localStorage.setItem(isCompletedExam,\"true\");props.history.push(\"/wdashboard\");});}else{_this.setState({writerDom:false},function(){localStorage.setItem(isCompletedExam,\"false\");props.history.push(\"/wexam\");});}/*if (this.state.sessionData.score !== '') {\n            props.history.push(\"/wdashboard\");\n          }\n          else {\n            props.history.push(\"/wexam\");\n          }*/case 31:return _context.abrupt(\"return\",{});case 32:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}()).catch(function(e){console.log(e);});};_this.verifyUser=function(id,props){console.log(\"my id first :\",id);instance.get(\"\".concat(process.env.REACT_APP_DATABASEURL,\"auth/verify/\").concat(id)).then(function(response){var resStatus=response.data.status;console.log(resStatus);props.history.push(\"/login\");return true;}).catch(function(e){console.log(e);});};_this.registerUser=function(_ref3){var firstname=_ref3.firstname,lastname=_ref3.lastname,phone=_ref3.phone,email=_ref3.email,country=_ref3.country,password=_ref3.password,role=_ref3.role;return new Promise(function(resolve,reject){// console.log({firstname, lastname,\n//   phone,\n//   email,\n//   country,\n//   password,\n//   role})\nvar filterUserId=function filterUserId(resData){var str=resData;var res=str.replace(/\\D/g,\"\");return res;};instance.post(\"\".concat(process.env.REACT_APP_DATABASEURL,\"auth/signup\"),{firstname:firstname,lastname:lastname,phone:phone,email:email,country:country,password:password,role:role}).then(function(response){var user=response.data;var verifyId=filterUserId(user.data);_this.setState({sessionData:{register:verifyId}});console.log(verifyId);console.log(\"register response\",user);console.log(resolve(response));resolve(response);}).catch(function(e){console.log(e);reject(e);});});};_this.updateClientProfile=function(_ref4,userId){var firstName=_ref4.firstName,lastName=_ref4.lastName,phone=_ref4.phone,email=_ref4.email,country=_ref4.country;return new Promise(function(resolve,reject){console.log(\"token preview\",firstName);// console.log(\"this is update profile data received : \",{ firstName, lastName, phone, email, country },userId)\nvar token=localStorage.getItem(\"token\");instance.put(\"\".concat(process.env.REACT_APP_DATABASEURL,\"user/\").concat(userId),{firstname:firstName,lastname:lastName,phone:phone,email:email,country:country},{headers:{Authorization:\"Bearer \".concat(token)}}).then(function(data){console.log(data);console.log(\"Auth user\",localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));var x=localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);x=JSON.parse(x);console.log(x);x.first_name=firstName;x.last_name=lastName;localStorage.setItem('authUser',JSON.stringify(x));console.log(\"hitting updateclientProfile\");console.log(data);_this.setState({updatedProfile:!_this.state.updatedProfile});resolve(data);}).catch(function(e){console.log(e);reject(e);});});};_this.state={updatedProfile:false,sessionData:{user:null,accessToken:\"\",userId:-1,register:null,score:''},writerDom:false};_this.init();return _this;}_createClass(UserContainer,[{key:\"ispermission\",value:function ispermission(){var _this$state,_this$state$sessionDa,_this$state$sessionDa2,_this$state$sessionDa3,_this$state2,_this$state2$sessionD,_this$state2$sessionD2,_this$state2$sessionD3;var role=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_toConsumableArray(ROLES);console.log((_this$state=this.state)===null||_this$state===void 0?void 0:(_this$state$sessionDa=_this$state.sessionData)===null||_this$state$sessionDa===void 0?void 0:(_this$state$sessionDa2=_this$state$sessionDa.user)===null||_this$state$sessionDa2===void 0?void 0:(_this$state$sessionDa3=_this$state$sessionDa2.Role)===null||_this$state$sessionDa3===void 0?void 0:_this$state$sessionDa3.role);var adminRole=(_this$state2=this.state)===null||_this$state2===void 0?void 0:(_this$state2$sessionD=_this$state2.sessionData)===null||_this$state2$sessionD===void 0?void 0:(_this$state2$sessionD2=_this$state2$sessionD.user)===null||_this$state2$sessionD2===void 0?void 0:(_this$state2$sessionD3=_this$state2$sessionD2.Role)===null||_this$state2$sessionD3===void 0?void 0:_this$state2$sessionD3.role;var isPermitted=role.filter(function(item){return item===adminRole;});return isPermitted.length>0?true:false;}}]);return UserContainer;}(Container);export{UserContainer};// let user,copySessionData;\n// console.log(\"check id \", this.state.userId);\n// user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n// user = JSON.parse(user);\n// copySessionData = ({}, this.state.sessionData);\n// copySessionData.userId = user.id;\n// this.setState({ sessionData: copySessionData });","map":{"version":3,"sources":["/Users/mac/writingPlatform/src/containers/UserContainer.js"],"names":["Container","instance","CONSTANTS","userRoutes","authRoutes","superadminRoutes","LOCAL_STORAGE_SIGNIN_KEY","isCompletedExam","ROLES","UserContainer","goBack","props","history","fetchUser","user","localStorage","getItem","JSON","parse","setState","sessionData","accessToken","access_token","userId","id","findWriterExam","bearertoken","Promise","resolve","reject","get","process","env","REACT_APP_DATABASEURL","headers","Authorization","then","response","console","log","data","catch","e","init","writerDom","signIn","email","password","post","setItem","stringify","Authuser","subRole","Role","role","push","writerExamStatus","status","verifyUser","resStatus","registerUser","firstname","lastname","phone","country","filterUserId","resData","str","res","replace","verifyId","register","updateClientProfile","firstName","lastName","token","put","x","first_name","last_name","updatedProfile","state","score","adminRole","isPermitted","filter","item","length"],"mappings":"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","sourcesContent":["import { Container } from \"unstated\";\nimport instance from \"../helpers/axiosly\";\nimport CONSTANTS from \"../helpers/App.constant\";\nimport { userRoutes, authRoutes, superadminRoutes } from \"../routes/allRoutes\";\nimport { LOCAL_STORAGE_SIGNIN_KEY, isCompletedExam } from '../App.constants'\nimport { ROLES } from '../App.constants'\n\nclass UserContainer extends Container {\n  constructor() {\n    super();\n    this.state = {\n      updatedProfile: false,\n      sessionData: {\n        user: null,\n        accessToken: \"\",\n        userId: -1,\n        register: null,\n        score: ''\n      },\n      writerDom: false\n    };\n\n    this.init();\n  }\n\n  ispermission(role = [...ROLES]) {\n    console.log(this.state?.sessionData?.user?.Role?.role)\n    const adminRole = this.state?.sessionData?.user?.Role?.role;\n\n    const isPermitted = role.filter(item => {\n      return item === adminRole\n    })\n\n    return isPermitted.length > 0 ? true : false;\n\n  }\n\n\n\n  goBack = (props) => {\n    props.history.goBack();\n  };\n\n  fetchUser = () => {\n    // copySessionData = ({}, this.state.sessionData);\n\n    // copySessionData.userId = user.id;\n    // console.log(\"new user id\", { sessionData: copySessionData });\n    let user\n\n    if (!localStorage.getItem('authUser')) {\n      user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY)\n    } else user = localStorage.getItem('authUser')\n    if (user) {\n\n      user = JSON.parse(user);\n      //   console.log(\"check access token\",user.access_token);\n      //   copySessionData.accessToken = user.access_token;\n      //   copySessionData.userId = user.id;\n\n      //   this.setState({ sessionData: copySessionData });\n      //   console.log(\"check access token\", copySessionData);\n\n      // console.log(\"check authuser from fetch :\", user);\n      this.setState({\n        sessionData: {\n          user: user,\n          accessToken: `${user.access_token}`,\n          userId: user.id,\n        },\n      })\n      return user;\n    }\n    return {};\n  };\n\n  findWriterExam = (userId,bearertoken) => {\n    return new Promise((resolve, reject)=> {\n    instance\n    .get(`${process.env.REACT_APP_DATABASEURL}exam/user/${userId}`, {\n      // {userId: userId},\n      headers: {\n        Authorization: `Bearer ${bearertoken}`,\n      },\n\n    }).then((response) => {\n      console.log(resolve(response?.data));\n      resolve(response?.data);\n\n    }).catch((e) => {\n      console.log(e);\n      console.log(e?.response?.data);\n      console.log(e?.response);\n      resolve(e?.response?.data);\n    });\n  })\n\n\n  }\n\n  init = () => {\n    try {\n      const writerDom = localStorage.getItem(isCompletedExam);\n      if (writerDom == 'true') {\n        this.setState({writerDom: true});\n      } else {\n        this.setState({writerDom: false});\n      }\n    } catch(e) {\n      this.setState({writerDom: false});\n    }\n  }\n\n  signIn = ({ email, password }, props) => {\n    instance\n      .post(`${process.env.REACT_APP_DATABASEURL}/auth/login`, { email, password })\n      .then(async (response) => {\n        const user = response.data.data;\n        console.log(user);\n\n        console.log(\"check base url \", process.env.REACT_APP_DATABASEURL)\n\n        localStorage.setItem(LOCAL_STORAGE_SIGNIN_KEY, JSON.stringify(response.data.data));\n        this.setState({\n          sessionData: {\n            user: user,\n            // accessToken: `${user.access_token}`,\n            userId: user.id,\n          },\n\n        });\n        let Authuser = JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY))\n        if (Authuser.subRole === \"Super-admin\") {\n          localStorage.setItem(\"users\", Authuser.subRole)\n        } else {\n          localStorage.setItem(\"users\", Authuser.Role.role)\n        }\n        localStorage.setItem(\"token\", Authuser.access_token)\n\n\n        //check if writer has a score and redirect\n        /*async function fetchData(){\n          try {\n            const res = await instance\n              .get(`${process.env.REACT_APP_DATABASEURL}/exam/user/${Authuser.id}`, {\n                headers: {\n                  Authorization: `Bearer ${Authuser.access_token}`,\n                },\n              })\n\n              if(res.data.data.score){\n                this.setState({\n                  sessionData: {\n                    score: res.data.data.score\n                  },})\n              }\n\n          } catch (e) {\n            console.log(e);\n          }\n          }\n          fetchData();*/\n\n\n        if (Authuser.Role.role === 'Client') {\n\n          localStorage.setItem(\"User\", 'Client')\n          props.history.push(\"/dashboard\");\n        }\n        else if (Authuser.subRole === 'Super-admin') {\n\n          localStorage.setItem(\"SuperAdmin\", 'SuperAdmin')\n          props.history.push(\"/admin-dashboard\");\n        } else if (Authuser.Role.role === 'Admin') {\n          localStorage.setItem(\"Admin\", 'Admin')\n          props.history.push(\"/admindashboard\");\n        } else if (Authuser.Role.role === 'Writer') {\n          localStorage.setItem(\"Writer\", 'Writer');\n          console.log(user);\n          const writerExamStatus = await this.findWriterExam(user?.id, user?.access_token);\n          console.log(writerExamStatus?.status, \"status of exam\");\n          if (writerExamStatus?.status == 'Success') {\n            this.setState({writerDom: true}, () => {\n              localStorage.setItem(isCompletedExam, \"true\");\n              props.history.push(\"/wdashboard\");\n            });\n          } else {\n            this.setState({writerDom: false}, () => {\n              localStorage.setItem(isCompletedExam, \"false\");\n              props.history.push(\"/wexam\");\n            });\n          }\n\n          /*if (this.state.sessionData.score !== '') {\n            props.history.push(\"/wdashboard\");\n          }\n          else {\n            props.history.push(\"/wexam\");\n          }*/\n        }\n\n\n\n\n        return {};\n\n      })\n      .catch((e) => {\n        console.log(e);\n      });\n\n  };\n\n  // /auth/verify/{id}\n  verifyUser = (id, props) => {\n    console.log(\"my id first :\", id)\n    instance\n      .get(`${process.env.REACT_APP_DATABASEURL}auth/verify/${id}`)\n      .then((response) => {\n        const resStatus = response.data.status;\n        console.log(resStatus);\n        props.history.push(\"/login\");\n\n        return true;\n\n      })\n      .catch((e) => {\n        console.log(e);\n\n      });\n  }\n\n\n  registerUser = ({ firstname, lastname,\n    phone,\n    email,\n    country,\n    password,\n    role }) => {\n    return new Promise((resolve, reject) => {\n      // console.log({firstname, lastname,\n      //   phone,\n      //   email,\n      //   country,\n      //   password,\n      //   role})\n      const filterUserId = (resData) => {\n        var str = resData;\n        var res = str.replace(/\\D/g, \"\");\n        return res;\n      }\n\n      instance\n        .post(`${process.env.REACT_APP_DATABASEURL}auth/signup`,\n          {\n            firstname: firstname, lastname: lastname,\n            phone: phone,\n            email: email,\n            country: country,\n            password: password,\n            role: role\n          })\n        .then((response) => {\n          const user = response.data;\n          const verifyId = filterUserId(user.data);\n          this.setState({\n            sessionData: {\n              register: verifyId\n            },\n          });\n          console.log(verifyId);\n          console.log(\"register response\", user)\n          console.log(resolve(response));\n          resolve(response);\n\n        })\n        .catch((e) => {\n          console.log(e);\n          reject(e);\n        });\n    })\n  }\n\n\n  updateClientProfile = ({ firstName, lastName, phone, email, country }, userId\n\n  ) => {\n    return new Promise((resolve, reject) => {\n      console.log(\"token preview\", firstName)\n\n      // console.log(\"this is update profile data received : \",{ firstName, lastName, phone, email, country },userId)\n      const token = localStorage.getItem(\"token\")\n      instance\n        .put(`${process.env.REACT_APP_DATABASEURL}user/${userId}`,\n          {\n            firstname: firstName,\n            lastname: lastName,\n            phone: phone,\n            email: email,\n            country: country\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          }\n        )\n        .then((data) => {\n          console.log(data);\n          console.log(\"Auth user\", localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));\n          let x = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n          x = JSON.parse(x);\n          console.log(x);\n          x.first_name = firstName;\n          x.last_name = lastName;\n\n          localStorage.setItem(\n            'authUser',\n            JSON.stringify(x)\n          );\n          console.log(\"hitting updateclientProfile\");\n          console.log(data);\n          this.setState({\n            updatedProfile: !this.state.updatedProfile\n          })\n          resolve(data);\n        })\n        .catch((e) => {\n          console.log(e);\n          reject(e);\n        });\n    })\n  }\n\n}\n\nexport { UserContainer };\n\n\n\n    // let user,copySessionData;\n    // console.log(\"check id \", this.state.userId);\n\n    // user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n    // user = JSON.parse(user);\n    // copySessionData = ({}, this.state.sessionData);\n\n    // copySessionData.userId = user.id;\n    // this.setState({ sessionData: copySessionData });"]},"metadata":{},"sourceType":"module"}