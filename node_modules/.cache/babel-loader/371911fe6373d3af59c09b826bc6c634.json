{"ast":null,"code":"import { Container } from \"unstated\";\nimport instance from \"../helpers/axiosly\";\nimport CONSTANTS from \"../helpers/App.constant\";\nimport { userRoutes, authRoutes, superadminRoutes } from \"../routes/allRoutes\";\nimport { LOCAL_STORAGE_SIGNIN_KEY, isCompletedExam } from '../App.constants';\nimport { ROLES } from '../App.constants';\n\nclass UserContainer extends Container {\n  constructor() {\n    super();\n\n    this.goBack = props => {\n      props.history.goBack();\n    };\n\n    this.fetchUser = () => {\n      // copySessionData = ({}, this.state.sessionData);\n      // copySessionData.userId = user.id;\n      // console.log(\"new user id\", { sessionData: copySessionData });\n      let user;\n\n      if (!localStorage.getItem('authUser')) {\n        user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n      } else user = localStorage.getItem('authUser');\n\n      if (user) {\n        user = JSON.parse(user); //   console.log(\"check access token\",user.access_token);\n        //   copySessionData.accessToken = user.access_token;\n        //   copySessionData.userId = user.id;\n        //   this.setState({ sessionData: copySessionData });\n        //   console.log(\"check access token\", copySessionData);\n        // console.log(\"check authuser from fetch :\", user);\n\n        this.setState({\n          sessionData: {\n            user: user,\n            accessToken: `${user.access_token}`,\n            userId: user.id\n          }\n        });\n        return user;\n      }\n\n      return {};\n    };\n\n    this.findWriterExam = (userId, bearertoken) => {\n      return new Promise((resolve, reject) => {\n        instance.get(`${process.env.REACT_APP_DATABASEURL}exam/user/${userId}`, {\n          // {userId: userId},\n          headers: {\n            Authorization: `Bearer ${bearertoken}`\n          }\n        }).then(response => {\n          console.log(resolve(response === null || response === void 0 ? void 0 : response.data));\n          resolve(response === null || response === void 0 ? void 0 : response.data);\n        }).catch(e => {\n          var _e$response, _e$response2;\n\n          console.log(e);\n          console.log(e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : _e$response.data);\n          console.log(e === null || e === void 0 ? void 0 : e.response);\n          resolve(e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : _e$response2.data);\n        });\n      });\n    };\n\n    this.init = () => {\n      try {\n        const writerDom = localStorage.getItem(isCompletedExam);\n\n        if (writerDom == 'true') {\n          this.setState({\n            writerDom: true\n          });\n        } else {\n          this.setState({\n            writerDom: false\n          });\n        }\n      } catch (e) {\n        this.setState({\n          writerDom: false\n        });\n      }\n    };\n\n    this.signIn = ({\n      email,\n      password\n    }, props) => {\n      return new Promise((resolve, reject) => {\n        instance.post(`${process.env.REACT_APP_DATABASEURL}/auth/login`, {\n          email,\n          password\n        }).then(async response => {\n          const user = response.data.data;\n          console.log(user);\n          console.log(\"check base url \", process.env.REACT_APP_DATABASEURL);\n          localStorage.setItem(LOCAL_STORAGE_SIGNIN_KEY, JSON.stringify(response.data.data));\n          console.log(user);\n          this.setState({\n            sessionData: {\n              user: user,\n              // accessToken: `${user.access_token}`,\n              userId: user.id\n            }\n          });\n          let Authuser = JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));\n\n          if (Authuser.subRole === \"Super-admin\") {\n            localStorage.setItem(\"users\", Authuser.subRole);\n          } else {\n            localStorage.setItem(\"users\", Authuser.Role.role);\n          }\n\n          localStorage.setItem(\"token\", Authuser.access_token); //check if writer has a score and redirect\n\n          /*async function fetchData(){\n            try {\n              const res = await instance\n                .get(`${process.env.REACT_APP_DATABASEURL}/exam/user/${Authuser.id}`, {\n                  headers: {\n                    Authorization: `Bearer ${Authuser.access_token}`,\n                  },\n                })\n                 if(res.data.data.score){\n                  this.setState({\n                    sessionData: {\n                      score: res.data.data.score\n                    },})\n                }\n             } catch (e) {\n              console.log(e);\n            }\n            }\n            fetchData();*/\n\n          if (Authuser.Role.role === 'Client') {\n            localStorage.setItem(\"User\", 'Client');\n            props.history.push(\"/dashboard\");\n          } else if (Authuser.subRole === 'Super-admin') {\n            localStorage.setItem(\"SuperAdmin\", 'SuperAdmin');\n            props.history.push(\"/admin-dashboard\");\n          } else if (Authuser.Role.role === 'Admin') {\n            localStorage.setItem(\"Admin\", 'Admin');\n            props.history.push(\"/admindashboard\");\n          } else if (Authuser.Role.role === 'Writer') {\n            localStorage.setItem(\"Writer\", 'Writer');\n            console.log(user);\n            const writerExamStatus = await this.findWriterExam(user === null || user === void 0 ? void 0 : user.id, user === null || user === void 0 ? void 0 : user.access_token);\n            console.log(writerExamStatus === null || writerExamStatus === void 0 ? void 0 : writerExamStatus.status, \"status of exam\");\n\n            if ((writerExamStatus === null || writerExamStatus === void 0 ? void 0 : writerExamStatus.status) == 'Success') {\n              this.setState({\n                writerDom: true\n              }, () => {\n                localStorage.setItem(isCompletedExam, \"true\");\n                props.history.push(\"/wdashboard\");\n              });\n            } else {\n              this.setState({\n                writerDom: false\n              }, () => {\n                localStorage.setItem(isCompletedExam, \"false\");\n                props.history.push(\"/wexam\");\n              });\n            }\n            /*if (this.state.sessionData.score !== '') {\n              props.history.push(\"/wdashboard\");\n            }\n            else {\n              props.history.push(\"/wexam\");\n            }*/\n\n          } // return {};\n\n\n          console.log(resolve(response));\n          resolve(response);\n        }).catch(e => {\n          console.log(e);\n          console.log(resolve(response));\n          resolve(response);\n        });\n      });\n    };\n\n    this.verifyUser = (id, props) => {\n      console.log(\"my id first :\", id);\n      instance.get(`${process.env.REACT_APP_DATABASEURL}auth/verify/${id}`).then(response => {\n        const resStatus = response.data.status;\n        console.log(resStatus);\n        props.history.push(\"/login\");\n        return true;\n      }).catch(e => {\n        console.log(e);\n      });\n    };\n\n    this.registerUser = ({\n      firstname,\n      lastname,\n      phone,\n      email,\n      country,\n      password,\n      role\n    }) => {\n      return new Promise((resolve, reject) => {\n        // console.log({firstname, lastname,\n        //   phone,\n        //   email,\n        //   country,\n        //   password,\n        //   role})\n        const filterUserId = resData => {\n          var str = resData;\n          var res = str.replace(/\\D/g, \"\");\n          return res;\n        };\n\n        instance.post(`${process.env.REACT_APP_DATABASEURL}auth/signup`, {\n          firstname: firstname,\n          lastname: lastname,\n          phone: phone,\n          email: email,\n          country: country,\n          password: password,\n          role: role\n        }).then(response => {\n          const user = response.data;\n          const verifyId = filterUserId(user.data);\n          this.setState({\n            sessionData: {\n              register: verifyId\n            }\n          });\n          console.log(verifyId);\n          console.log(\"register response\", user);\n          console.log(resolve(response));\n          resolve(response);\n        }).catch(e => {\n          console.log(e);\n          reject(e);\n        });\n      });\n    };\n\n    this.updateClientProfile = ({\n      firstName,\n      lastName,\n      phone,\n      email,\n      country\n    }, userId) => {\n      return new Promise((resolve, reject) => {\n        console.log(\"token preview\", firstName); // console.log(\"this is update profile data received : \",{ firstName, lastName, phone, email, country },userId)\n\n        const token = localStorage.getItem(\"token\");\n        instance.put(`${process.env.REACT_APP_DATABASEURL}user/${userId}`, {\n          firstname: firstName,\n          lastname: lastName,\n          phone: phone,\n          email: email,\n          country: country\n        }, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }).then(data => {\n          console.log(data);\n          console.log(\"Auth user\", localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));\n          let x = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n          x = JSON.parse(x);\n          console.log(x);\n          x.first_name = firstName;\n          x.last_name = lastName;\n          localStorage.setItem('authUser', JSON.stringify(x));\n          console.log(\"hitting updateclientProfile\");\n          console.log(data);\n          this.setState({\n            updatedProfile: !this.state.updatedProfile\n          });\n          resolve(data);\n        }).catch(e => {\n          console.log(e);\n          reject(e);\n        });\n      });\n    };\n\n    this.state = {\n      updatedProfile: false,\n      sessionData: {\n        user: null,\n        accessToken: \"\",\n        userId: -1,\n        register: null,\n        score: ''\n      },\n      writerDom: false\n    };\n    this.init();\n  }\n\n  ispermission(role = [...ROLES]) {\n    var _this$state, _this$state$sessionDa, _this$state$sessionDa2, _this$state$sessionDa3, _this$state2, _this$state2$sessionD, _this$state2$sessionD2, _this$state2$sessionD3;\n\n    console.log((_this$state = this.state) === null || _this$state === void 0 ? void 0 : (_this$state$sessionDa = _this$state.sessionData) === null || _this$state$sessionDa === void 0 ? void 0 : (_this$state$sessionDa2 = _this$state$sessionDa.user) === null || _this$state$sessionDa2 === void 0 ? void 0 : (_this$state$sessionDa3 = _this$state$sessionDa2.Role) === null || _this$state$sessionDa3 === void 0 ? void 0 : _this$state$sessionDa3.role);\n    const adminRole = (_this$state2 = this.state) === null || _this$state2 === void 0 ? void 0 : (_this$state2$sessionD = _this$state2.sessionData) === null || _this$state2$sessionD === void 0 ? void 0 : (_this$state2$sessionD2 = _this$state2$sessionD.user) === null || _this$state2$sessionD2 === void 0 ? void 0 : (_this$state2$sessionD3 = _this$state2$sessionD2.Role) === null || _this$state2$sessionD3 === void 0 ? void 0 : _this$state2$sessionD3.role;\n    const isPermitted = role.filter(item => {\n      return item === adminRole;\n    });\n    return isPermitted.length > 0 ? true : false;\n  }\n\n}\n\nexport { UserContainer }; // let user,copySessionData;\n// console.log(\"check id \", this.state.userId);\n// user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n// user = JSON.parse(user);\n// copySessionData = ({}, this.state.sessionData);\n// copySessionData.userId = user.id;\n// this.setState({ sessionData: copySessionData });","map":{"version":3,"sources":["/Users/mac/writingPlatform/src/containers/UserContainer.js"],"names":["Container","instance","CONSTANTS","userRoutes","authRoutes","superadminRoutes","LOCAL_STORAGE_SIGNIN_KEY","isCompletedExam","ROLES","UserContainer","constructor","goBack","props","history","fetchUser","user","localStorage","getItem","JSON","parse","setState","sessionData","accessToken","access_token","userId","id","findWriterExam","bearertoken","Promise","resolve","reject","get","process","env","REACT_APP_DATABASEURL","headers","Authorization","then","response","console","log","data","catch","e","init","writerDom","signIn","email","password","post","setItem","stringify","Authuser","subRole","Role","role","push","writerExamStatus","status","verifyUser","resStatus","registerUser","firstname","lastname","phone","country","filterUserId","resData","str","res","replace","verifyId","register","updateClientProfile","firstName","lastName","token","put","x","first_name","last_name","updatedProfile","state","score","ispermission","adminRole","isPermitted","filter","item","length"],"mappings":"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","sourcesContent":["import { Container } from \"unstated\";\nimport instance from \"../helpers/axiosly\";\nimport CONSTANTS from \"../helpers/App.constant\";\nimport { userRoutes, authRoutes, superadminRoutes } from \"../routes/allRoutes\";\nimport { LOCAL_STORAGE_SIGNIN_KEY, isCompletedExam } from '../App.constants'\nimport { ROLES } from '../App.constants'\n\nclass UserContainer extends Container {\n  constructor() {\n    super();\n    this.state = {\n      updatedProfile: false,\n      sessionData: {\n        user: null,\n        accessToken: \"\",\n        userId: -1,\n        register: null,\n        score: ''\n      },\n      writerDom: false\n    };\n\n    this.init();\n  }\n\n  ispermission(role = [...ROLES]) {\n    console.log(this.state?.sessionData?.user?.Role?.role)\n    const adminRole = this.state?.sessionData?.user?.Role?.role;\n\n    const isPermitted = role.filter(item => {\n      return item === adminRole\n    })\n\n    return isPermitted.length > 0 ? true : false;\n\n  }\n\n\n\n  goBack = (props) => {\n    props.history.goBack();\n  };\n\n  fetchUser = () => {\n    // copySessionData = ({}, this.state.sessionData);\n\n    // copySessionData.userId = user.id;\n    // console.log(\"new user id\", { sessionData: copySessionData });\n    let user\n\n    if (!localStorage.getItem('authUser')) {\n      user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY)\n    } else user = localStorage.getItem('authUser')\n    if (user) {\n\n      user = JSON.parse(user);\n      //   console.log(\"check access token\",user.access_token);\n      //   copySessionData.accessToken = user.access_token;\n      //   copySessionData.userId = user.id;\n\n      //   this.setState({ sessionData: copySessionData });\n      //   console.log(\"check access token\", copySessionData);\n\n      // console.log(\"check authuser from fetch :\", user);\n      this.setState({\n        sessionData: {\n          user: user,\n          accessToken: `${user.access_token}`,\n          userId: user.id,\n        },\n      })\n      return user;\n    }\n    return {};\n  };\n\n  findWriterExam = (userId,bearertoken) => {\n    return new Promise((resolve, reject)=> {\n    instance\n    .get(`${process.env.REACT_APP_DATABASEURL}exam/user/${userId}`, {\n      // {userId: userId},\n      headers: {\n        Authorization: `Bearer ${bearertoken}`,\n      },\n\n    }).then((response) => {\n      console.log(resolve(response?.data));\n      resolve(response?.data);\n\n    }).catch((e) => {\n      console.log(e);\n      console.log(e?.response?.data);\n      console.log(e?.response);\n      resolve(e?.response?.data);\n    });\n  })\n\n\n  }\n\n  init = () => {\n    try {\n      const writerDom = localStorage.getItem(isCompletedExam);\n      if (writerDom == 'true') {\n        this.setState({writerDom: true});\n      } else {\n        this.setState({writerDom: false});\n      }\n    } catch(e) {\n      this.setState({writerDom: false});\n    }\n  }\n\n  signIn = ({ email, password }, props) => {\n    return new Promise((resolve, reject) => {\n      instance\n      .post(`${process.env.REACT_APP_DATABASEURL}/auth/login`, { email, password })\n      .then(async (response) => {\n        const user = response.data.data;\n        console.log(user);\n\n        console.log(\"check base url \", process.env.REACT_APP_DATABASEURL)\n\n        localStorage.setItem(LOCAL_STORAGE_SIGNIN_KEY, JSON.stringify(response.data.data));\n        console.log(user)\n\n        this.setState({\n          sessionData: {\n            user: user,\n            // accessToken: `${user.access_token}`,\n            userId: user.id,\n          },\n\n        });\n        let Authuser = JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY))\n        if (Authuser.subRole === \"Super-admin\") {\n          localStorage.setItem(\"users\", Authuser.subRole)\n        } else {\n          localStorage.setItem(\"users\", Authuser.Role.role)\n        }\n        localStorage.setItem(\"token\", Authuser.access_token)\n\n\n        //check if writer has a score and redirect\n        /*async function fetchData(){\n          try {\n            const res = await instance\n              .get(`${process.env.REACT_APP_DATABASEURL}/exam/user/${Authuser.id}`, {\n                headers: {\n                  Authorization: `Bearer ${Authuser.access_token}`,\n                },\n              })\n\n              if(res.data.data.score){\n                this.setState({\n                  sessionData: {\n                    score: res.data.data.score\n                  },})\n              }\n\n          } catch (e) {\n            console.log(e);\n          }\n          }\n          fetchData();*/\n\n\n        if (Authuser.Role.role === 'Client') {\n\n          localStorage.setItem(\"User\", 'Client')\n          props.history.push(\"/dashboard\");\n        }\n        else if (Authuser.subRole === 'Super-admin') {\n\n          localStorage.setItem(\"SuperAdmin\", 'SuperAdmin')\n          props.history.push(\"/admin-dashboard\");\n        } else if (Authuser.Role.role === 'Admin') {\n          localStorage.setItem(\"Admin\", 'Admin')\n          props.history.push(\"/admindashboard\");\n        } else if (Authuser.Role.role === 'Writer') {\n          localStorage.setItem(\"Writer\", 'Writer');\n          console.log(user);\n          const writerExamStatus = await this.findWriterExam(user?.id, user?.access_token);\n          console.log(writerExamStatus?.status, \"status of exam\");\n          if (writerExamStatus?.status == 'Success') {\n            this.setState({writerDom: true}, () => {\n              localStorage.setItem(isCompletedExam, \"true\");\n              props.history.push(\"/wdashboard\");\n            });\n          } else {\n            this.setState({writerDom: false}, () => {\n              localStorage.setItem(isCompletedExam, \"false\");\n              props.history.push(\"/wexam\");\n            });\n          }\n\n          /*if (this.state.sessionData.score !== '') {\n            props.history.push(\"/wdashboard\");\n          }\n          else {\n            props.history.push(\"/wexam\");\n          }*/\n        }\n\n\n\n\n        // return {};\n        console.log(resolve(response));\n        resolve(response);\n\n      })\n      .catch((e) => {\n        console.log(e);\n        console.log(resolve(response));\n          resolve(response);\n      });\n\n    })\n    \n\n  };\n\n  // /auth/verify/{id}\n  verifyUser = (id, props) => {\n    console.log(\"my id first :\", id)\n    instance\n      .get(`${process.env.REACT_APP_DATABASEURL}auth/verify/${id}`)\n      .then((response) => {\n        const resStatus = response.data.status;\n        console.log(resStatus);\n        props.history.push(\"/login\");\n\n        return true;\n\n      })\n      .catch((e) => {\n        console.log(e);\n\n      });\n  }\n\n\n  registerUser = ({ firstname, lastname,\n    phone,\n    email,\n    country,\n    password,\n    role }) => {\n    return new Promise((resolve, reject) => {\n      // console.log({firstname, lastname,\n      //   phone,\n      //   email,\n      //   country,\n      //   password,\n      //   role})\n      const filterUserId = (resData) => {\n        var str = resData;\n        var res = str.replace(/\\D/g, \"\");\n        return res;\n      }\n\n      instance\n        .post(`${process.env.REACT_APP_DATABASEURL}auth/signup`,\n          {\n            firstname: firstname, lastname: lastname,\n            phone: phone,\n            email: email,\n            country: country,\n            password: password,\n            role: role\n          })\n        .then((response) => {\n          const user = response.data;\n          const verifyId = filterUserId(user.data);\n          this.setState({\n            sessionData: {\n              register: verifyId\n            },\n          });\n          console.log(verifyId);\n          console.log(\"register response\", user)\n          console.log(resolve(response));\n          resolve(response);\n\n        })\n        .catch((e) => {\n          console.log(e);\n          reject(e);\n        });\n    })\n  }\n\n\n  updateClientProfile = ({ firstName, lastName, phone, email, country }, userId\n\n  ) => {\n    return new Promise((resolve, reject) => {\n      console.log(\"token preview\", firstName)\n\n      // console.log(\"this is update profile data received : \",{ firstName, lastName, phone, email, country },userId)\n      const token = localStorage.getItem(\"token\")\n      instance\n        .put(`${process.env.REACT_APP_DATABASEURL}user/${userId}`,\n          {\n            firstname: firstName,\n            lastname: lastName,\n            phone: phone,\n            email: email,\n            country: country\n          },\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          }\n        )\n        .then((data) => {\n          console.log(data);\n          console.log(\"Auth user\", localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));\n          let x = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n          x = JSON.parse(x);\n          console.log(x);\n          x.first_name = firstName;\n          x.last_name = lastName;\n\n          localStorage.setItem(\n            'authUser',\n            JSON.stringify(x)\n          );\n          console.log(\"hitting updateclientProfile\");\n          console.log(data);\n          this.setState({\n            updatedProfile: !this.state.updatedProfile\n          })\n          resolve(data);\n        })\n        .catch((e) => {\n          console.log(e);\n          reject(e);\n        });\n    })\n  }\n\n}\n\nexport { UserContainer };\n\n\n\n    // let user,copySessionData;\n    // console.log(\"check id \", this.state.userId);\n\n    // user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n    // user = JSON.parse(user);\n    // copySessionData = ({}, this.state.sessionData);\n\n    // copySessionData.userId = user.id;\n    // this.setState({ sessionData: copySessionData });"]},"metadata":{},"sourceType":"module"}