{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectWithoutProperties from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import React,{useEffect}from\"react\";import{Route,Redirect,withRouter}from\"react-router-dom\";import{LOCAL_STORAGE_SIGNIN_KEY}from'../../App.constants';import{grantPermission}from'../../GrantPermission';import{ROLES}from'../../App.constants';import stateWrapper from'../../containers/provider';/*const Authmiddleware = ({\n\tcomponent: Component,\n\tlayout: Layout,\n\trender,\n  \troles,\n  \t...rest\n}) => (\n\t\t<Route\n\t\t{...rest}\n\t\t\trender={props => {\n\t\t\t\n\t\t\t\t\n\t\t\tlet Currentuser = JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY))\n\n\t\t\t\n\t\t\t// here you can apply condition\n\t\t\tif (!grantPermission([ROLES.ADMIN])) {\n\t\t\t\tconsole.log(roles)\n\t\t\t\treturn (\n\t\t\t\t\t<Redirect to={{ pathname: \"/login\", state: { from: props.location } }} />\n\t\t\t\t);\n\t\t\t}\n\t\t\t\treturn (\n\t\t     \t<Layout>\n\t\t\t\t\t\t<Component {...props} />\n\t\t\t\t</Layout>\n\t\t\t\t);\n\t\t\t}}\n\t\t/>\n\t);*/function Authmiddleware(_ref){var Component=_ref.component,Layout=_ref.layout,roles=_ref.roles,rest=_objectWithoutProperties(_ref,[\"component\",\"layout\",\"roles\"]);useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _rest$userStore,_rest$orderStore;var userData,bearertoken,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:userData=rest===null||rest===void 0?void 0:(_rest$userStore=rest.userStore)===null||_rest$userStore===void 0?void 0:_rest$userStore.fetchUser();bearertoken=userData===null||userData===void 0?void 0:userData.access_token;console.log(userData,bearertoken);result=rest===null||rest===void 0?void 0:(_rest$orderStore=rest.orderStore)===null||_rest$orderStore===void 0?void 0:_rest$orderStore.fetchOrders(userData,bearertoken);console.log(result);case 5:case\"end\":return _context.stop();}}},_callee);}))();},[]);return/*#__PURE__*/React.createElement(React.Fragment,null,grantPermission([ROLES.CLIENT])&&/*#__PURE__*/React.createElement(Route,Object.assign({},rest,{render:function render(props){return/*#__PURE__*/React.createElement(Layout,null,/*#__PURE__*/React.createElement(Component,props));}})),!grantPermission([ROLES.CLIENT])&&/*#__PURE__*/React.createElement(Route,Object.assign({},rest,{render:function render(props){return/*#__PURE__*/React.createElement(Redirect,{to:{pathname:\"/login\",state:{from:props.location}}});}})));}export default withRouter(stateWrapper(Authmiddleware));","map":{"version":3,"sources":["/Users/mac/writingPlatform/src/routes/middleware/Authmiddleware.js"],"names":["React","useEffect","Route","Redirect","withRouter","LOCAL_STORAGE_SIGNIN_KEY","grantPermission","ROLES","stateWrapper","Authmiddleware","Component","component","Layout","layout","roles","rest","userData","userStore","fetchUser","bearertoken","access_token","console","log","result","orderStore","fetchOrders","CLIENT","props","pathname","state","from","location"],"mappings":"ocAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,KAAT,CAAeC,QAAf,CAAwBC,UAAxB,KAA0C,kBAA1C,CACA,OAAQC,wBAAR,KAAuC,qBAAvC,CACA,OAAQC,eAAR,KAA8B,uBAA9B,CACA,OAAQC,KAAR,KAAoB,qBAApB,CACA,MAAOC,CAAAA,YAAP,KAAyB,2BAAzB,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAEC,QAASC,CAAAA,cAAT,MAEK,IADOC,CAAAA,SACP,MADJC,SACI,CAD0BC,MAC1B,MADkBC,MAClB,CADkCC,KAClC,MADkCA,KAClC,CAD4CC,IAC5C,+DACFd,SAAS,CAAC,UAAM,CACf,wDAAC,wMACIe,QADJ,CACeD,IADf,SACeA,IADf,kCACeA,IAAI,CAAEE,SADrB,0CACe,gBAAiBC,SAAjB,EADf,CAEIC,WAFJ,CAEkBH,QAFlB,SAEkBA,QAFlB,iBAEkBA,QAAQ,CAAEI,YAF5B,CAGFC,OAAO,CAACC,GAAR,CAAYN,QAAZ,CAAsBG,WAAtB,EACMI,MAJJ,CAIaR,IAJb,SAIaA,IAJb,mCAIaA,IAAI,CAAES,UAJnB,2CAIa,iBAAkBC,WAAlB,CAA8BT,QAA9B,CAAwCG,WAAxC,CAJb,CAKFE,OAAO,CAACC,GAAR,CAAYC,MAAZ,EALE,sDAAD,KAQA,CATQ,CASN,EATM,CAAT,CAUF,mBACE,wCACCjB,eAAe,CAAC,CAACC,KAAK,CAACmB,MAAP,CAAD,CAAf,eACF,oBAAC,KAAD,kBACMX,IADN,EAEE,MAAM,CAAE,gBAACY,KAAD,qBACT,oBAAC,MAAD,mBACE,oBAAC,SAAD,CAAeA,KAAf,CADF,CADS,EAFV,GAFC,CAYC,CAACrB,eAAe,CAAC,CAACC,KAAK,CAACmB,MAAP,CAAD,CAAhB,eACD,oBAAC,KAAD,kBACIX,IADJ,EAEA,MAAM,CAAE,gBAACY,KAAD,qBACP,oBAAC,QAAD,EAAW,EAAE,CAAE,CAAEC,QAAQ,CAAE,QAAZ,CAAsBC,KAAK,CAAE,CAAEC,IAAI,CAAEH,KAAK,CAACI,QAAd,CAA7B,CAAf,EADO,EAFR,GAbA,CADF,CA0BE,CAEJ,cAAe3B,CAAAA,UAAU,CAACI,YAAY,CAACC,cAAD,CAAb,CAAzB","sourcesContent":["import React, { useEffect } from \"react\";\nimport { Route,Redirect,withRouter } from \"react-router-dom\";\nimport {LOCAL_STORAGE_SIGNIN_KEY} from '../../App.constants'\nimport {grantPermission} from '../../GrantPermission'\nimport {ROLES} from '../../App.constants';\nimport stateWrapper from '../../containers/provider';\n\n/*const Authmiddleware = ({\n\tcomponent: Component,\n\tlayout: Layout,\n\trender,\n  \troles,\n  \t...rest\n}) => (\n\t\t<Route\n\t\t{...rest}\n\t\t\trender={props => {\n\t\t\t\n\t\t\t\t\n\t\t\tlet Currentuser = JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY))\n\n\t\t\t\n\t\t\t// here you can apply condition\n\t\t\tif (!grantPermission([ROLES.ADMIN])) {\n\t\t\t\tconsole.log(roles)\n\t\t\t\treturn (\n\t\t\t\t\t<Redirect to={{ pathname: \"/login\", state: { from: props.location } }} />\n\t\t\t\t);\n\t\t\t}\n\t\t\t\treturn (\n\t\t     \t<Layout>\n\t\t\t\t\t\t<Component {...props} />\n\t\t\t\t</Layout>\n\t\t\t\t);\n\t\t\t}}\n\t\t/>\n\t);*/\n\n\tfunction Authmiddleware({\n\t\tcomponent: Component, layout: Layout, roles, ...rest\n\t  }) {\n\t\t  useEffect(() => {\n\t\t\t  (async () => {\n\t\t\t\tconst userData = rest?.userStore?.fetchUser();\n\t\t\t\tconst bearertoken = userData?.access_token;\n\t\t\t\tconsole.log(userData, bearertoken);\n\t\t\t\tconst result = rest?.orderStore?.fetchOrders(userData, bearertoken);\n\t\t\t\tconsole.log(result);\n\t\t\t  })()\n\n\t\t  }, [])\n\t\treturn (\n\t\t  <>\n\t\t\t{ grantPermission([ROLES.CLIENT]) && (\n\t\t\t<Route\n\t\t\t  {...rest}\n\t\t\t  render={(props) => (\n\t\t\t\t<Layout>\n\t\t\t\t  <Component {...props} />\n\t\t\t\t</Layout>\n\t\t\t  )}\n\t\t\t/>\n\t\t\t)}\n\t\t\t{\n\t\t\t  !grantPermission([ROLES.CLIENT]) && (\n\t\t\t\t<Route \n\t\t\t\t{...rest}\n\t\t\t\trender={(props) => (\n\t\t\t\t\t<Redirect  to={{ pathname: \"/login\", state: { from: props.location } }} />\n\t\t\t\t)}\n\t\t\t\t\t\n\t\t\t\t/>\n\t\t\t\t\n\t\t\t  )\n\t\t\t}\n\t\t  </>\n\t\t);\n\t  }\n\nexport default withRouter(stateWrapper(Authmiddleware));\n\n"]},"metadata":{},"sourceType":"module"}