{"ast":null,"code":"import _toConsumableArray from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/mac/writingPlatform/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Container}from\"unstated\";import instance from\"../helpers/axiosly\";import CONSTANTS from\"../helpers/App.constant\";import{userRoutes,authRoutes,superadminRoutes}from\"../routes/allRoutes\";import{LOCAL_STORAGE_SIGNIN_KEY}from'../App.constants';import{ROLES}from'../App.constants';var UserContainer=/*#__PURE__*/function(_Container){_inherits(UserContainer,_Container);var _super=_createSuper(UserContainer);function UserContainer(){var _this;_classCallCheck(this,UserContainer);_this=_super.call(this);_this.goBack=function(props){props.history.goBack();};_this.fetchUser=function(){// copySessionData = ({}, this.state.sessionData);\n// copySessionData.userId = user.id;\n// console.log(\"new user id\", { sessionData: copySessionData });\nvar user;if(!localStorage.getItem('authUser')){user=localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);}else user=localStorage.getItem('authUser');if(user){user=JSON.parse(user);//   console.log(\"check access token\",user.access_token);\n//   copySessionData.accessToken = user.access_token;\n//   copySessionData.userId = user.id;\n//   this.setState({ sessionData: copySessionData });\n//   console.log(\"check access token\", copySessionData);\n// console.log(\"check authuser from fetch :\", user);\n_this.setState({sessionData:{user:user,accessToken:\"\".concat(user.access_token),userId:user.id}});console.log(user);return user;}return{};};_this.signIn=function(_ref,props){var email=_ref.email,password=_ref.password;instance.post(\"\".concat(process.env.REACT_APP_DATABASEURL,\"/auth/login\"),{email:email,password:password}).then(function(response){var user=response.data.data;console.log(user);console.log(\"check base url \",process.env.REACT_APP_DATABASEURL);localStorage.setItem(LOCAL_STORAGE_SIGNIN_KEY,JSON.stringify(response.data.data));_this.setState({sessionData:{user:user,// accessToken: `${user.access_token}`,\nuserId:user.id}});var Authuser=JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));if(Authuser.subRole===\"Super-admin\"){localStorage.setItem(\"users\",Authuser.subRole);}else{localStorage.setItem(\"users\",Authuser.Role.role);}localStorage.setItem(\"token\",Authuser.access_token);//check if writer has a score and redirect\n/*async function fetchData(){\n          try {\n            const res = await instance\n              .get(`${process.env.REACT_APP_DATABASEURL}/exam/user/${Authuser.id}`, {\n                headers: {\n                  Authorization: `Bearer ${Authuser.access_token}`,\n                },\n              })\n\n              if(res.data.data.score){\n                this.setState({\n                  sessionData: {\n                    score: res.data.data.score\n                  },})\n              }\n\n          } catch (e) {\n            console.log(e);\n          }\n          }\n          fetchData();*/if(Authuser.Role.role==='Client'){localStorage.setItem(\"User\",'Client');props.history.push(\"/dashboard\");}else if(Authuser.subRole==='Super-admin'){localStorage.setItem(\"SuperAdmin\",'SuperAdmin');props.history.push(\"/admin-dashboard\");}else if(Authuser.Role.role==='Admin'){localStorage.setItem(\"Admin\",'Admin');props.history.push(\"/admindashboard\");}else if(Authuser.Role.role==='Writer'){localStorage.setItem(\"Writer\",'Writer');props.history.push(\"/wexam\");/*if (this.state.sessionData.score !== '') {\n            props.history.push(\"/wdashboard\");\n          }\n          else {\n            props.history.push(\"/wexam\");\n          }*/}return{};}).catch(function(e){console.log(e);});};_this.verifyUser=function(id,props){console.log(\"my id first :\",id);instance.get(\"\".concat(process.env.REACT_APP_DATABASEURL,\"auth/verify/\").concat(id)).then(function(response){var resStatus=response.data.status;console.log(resStatus);props.history.push(\"/login\");return true;}).catch(function(e){console.log(e);});};_this.registerUser=function(_ref2){var firstname=_ref2.firstname,lastname=_ref2.lastname,phone=_ref2.phone,email=_ref2.email,country=_ref2.country,password=_ref2.password,role=_ref2.role;return new Promise(function(resolve,reject){// console.log({firstname, lastname,\n//   phone,\n//   email,\n//   country,\n//   password,\n//   role})\nvar filterUserId=function filterUserId(resData){var str=resData;var res=str.replace(/\\D/g,\"\");return res;};instance.post(\"\".concat(process.env.REACT_APP_DATABASEURL,\"auth/signup\"),{firstname:firstname,lastname:lastname,phone:phone,email:email,country:country,password:password,role:role}).then(function(response){var user=response.data;var verifyId=filterUserId(user.data);_this.setState({sessionData:{register:verifyId}});console.log(verifyId);console.log(\"register response\",user);console.log(resolve(response));resolve(response);}).catch(function(e){console.log(e);reject(e);});});};_this.updateClientProfile=function(_ref3,userId){var firstName=_ref3.firstName,lastName=_ref3.lastName,phone=_ref3.phone,email=_ref3.email,country=_ref3.country;return new Promise(function(resolve,reject){console.log(\"token preview\",firstName);// console.log(\"this is update profile data received : \",{ firstName, lastName, phone, email, country },userId)\nvar token=localStorage.getItem(\"token\");instance.put(\"\".concat(process.env.REACT_APP_DATABASEURL,\"user/\").concat(userId),{firstname:firstName,lastname:lastName,phone:phone,email:email,country:country},{headers:{Authorization:\"Bearer \".concat(token)}}).then(function(data){console.log(data);console.log(\"Auth user\",localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));var x=localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);x=JSON.parse(x);console.log(x);x.first_name=firstName;x.last_name=lastName;localStorage.setItem('authUser',JSON.stringify(x));console.log(\"hitting updateclientProfile\");console.log(data);_this.setState({updatedProfile:!_this.state.updatedProfile});resolve(data);}).catch(function(e){console.log(e);reject(e);});});};_this.state={updatedProfile:false,sessionData:{user:null,accessToken:\"\",userId:-1,register:null,score:''}};return _this;}_createClass(UserContainer,[{key:\"ispermission\",value:function ispermission(){var _this$state,_this$state$sessionDa,_this$state$sessionDa2,_this$state$sessionDa3,_this$state2,_this$state2$sessionD,_this$state2$sessionD2,_this$state2$sessionD3;var role=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_toConsumableArray(ROLES);console.log((_this$state=this.state)===null||_this$state===void 0?void 0:(_this$state$sessionDa=_this$state.sessionData)===null||_this$state$sessionDa===void 0?void 0:(_this$state$sessionDa2=_this$state$sessionDa.user)===null||_this$state$sessionDa2===void 0?void 0:(_this$state$sessionDa3=_this$state$sessionDa2.Role)===null||_this$state$sessionDa3===void 0?void 0:_this$state$sessionDa3.role);var adminRole=(_this$state2=this.state)===null||_this$state2===void 0?void 0:(_this$state2$sessionD=_this$state2.sessionData)===null||_this$state2$sessionD===void 0?void 0:(_this$state2$sessionD2=_this$state2$sessionD.user)===null||_this$state2$sessionD2===void 0?void 0:(_this$state2$sessionD3=_this$state2$sessionD2.Role)===null||_this$state2$sessionD3===void 0?void 0:_this$state2$sessionD3.role;var isPermitted=role.filter(function(item){return item===adminRole;});return isPermitted.length>0?true:false;}}]);return UserContainer;}(Container);export{UserContainer};// let user,copySessionData;\n// console.log(\"check id \", this.state.userId);\n// user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n// user = JSON.parse(user);\n// copySessionData = ({}, this.state.sessionData);\n// copySessionData.userId = user.id;\n// this.setState({ sessionData: copySessionData });","map":{"version":3,"sources":["/Users/mac/writingPlatform/src/containers/UserContainer.js"],"names":["Container","instance","CONSTANTS","userRoutes","authRoutes","superadminRoutes","LOCAL_STORAGE_SIGNIN_KEY","ROLES","UserContainer","goBack","props","history","fetchUser","user","localStorage","getItem","JSON","parse","setState","sessionData","accessToken","access_token","userId","id","console","log","signIn","email","password","post","process","env","REACT_APP_DATABASEURL","then","response","data","setItem","stringify","Authuser","subRole","Role","role","push","catch","e","verifyUser","get","resStatus","status","registerUser","firstname","lastname","phone","country","Promise","resolve","reject","filterUserId","resData","str","res","replace","verifyId","register","updateClientProfile","firstName","lastName","token","put","headers","Authorization","x","first_name","last_name","updatedProfile","state","score","adminRole","isPermitted","filter","item","length"],"mappings":"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","sourcesContent":["import { Container } from \"unstated\";\nimport instance from \"../helpers/axiosly\";\nimport CONSTANTS from \"../helpers/App.constant\";\nimport { userRoutes , authRoutes,  superadminRoutes} from \"../routes/allRoutes\";\nimport {LOCAL_STORAGE_SIGNIN_KEY} from '../App.constants'\nimport {ROLES} from '../App.constants'\n\nclass UserContainer extends Container {\n  constructor() {\n    super();\n    this.state = {\n      updatedProfile: false,\n      sessionData: {\n        user: null,\n        accessToken: \"\",\n        userId: -1,\n        register:null,\n        score: ''\n      },\n    };\n  }\n\n  ispermission(role = [...ROLES]){\n    console.log(this.state?.sessionData?.user?.Role?.role)\n    const adminRole = this.state?.sessionData?.user?.Role?.role;\n\n    const isPermitted = role.filter(item => {\n      return item === adminRole\n    })\n\n    return isPermitted.length > 0 ? true : false;\n\n  }\n\n\n\n  goBack = (props) => {\n    props.history.goBack();\n  };\n\n  fetchUser = () => {\n    // copySessionData = ({}, this.state.sessionData);\n\n    // copySessionData.userId = user.id;\n    // console.log(\"new user id\", { sessionData: copySessionData });\n    let user\n\n    if(!localStorage.getItem('authUser')){\n      user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY)\n    } else user = localStorage.getItem('authUser')\n    if (user) {\n\n      user = JSON.parse(user);\n      //   console.log(\"check access token\",user.access_token);\n      //   copySessionData.accessToken = user.access_token;\n      //   copySessionData.userId = user.id;\n\n      //   this.setState({ sessionData: copySessionData });\n      //   console.log(\"check access token\", copySessionData);\n\n      // console.log(\"check authuser from fetch :\", user);\n      this.setState({\n        sessionData: {\n          user: user,\n          accessToken: `${user.access_token}`,\n          userId: user.id,\n        },})\n      console.log(user)\n      return user;\n    }\n    return {};\n  };\n\n\n  signIn = ({ email, password }, props) => {\n    instance\n      .post(`${process.env.REACT_APP_DATABASEURL}/auth/login`, { email, password })\n      .then((response) => {\n        const user = response.data.data;\n        console.log(user);\n\n        console.log(\"check base url \",process.env.REACT_APP_DATABASEURL)\n\n        localStorage.setItem(LOCAL_STORAGE_SIGNIN_KEY, JSON.stringify(response.data.data));\n        this.setState({\n          sessionData: {\n            user: user,\n            // accessToken: `${user.access_token}`,\n            userId: user.id,\n          },\n\n        });\n        let Authuser = JSON.parse(localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY))\n        if (Authuser.subRole === \"Super-admin\") {\n          localStorage.setItem(\"users\", Authuser.subRole)\n        } else {\n          localStorage.setItem(\"users\", Authuser.Role.role)\n        }\n        localStorage.setItem(\"token\", Authuser.access_token)\n\n\n        //check if writer has a score and redirect\n        /*async function fetchData(){\n          try {\n            const res = await instance\n              .get(`${process.env.REACT_APP_DATABASEURL}/exam/user/${Authuser.id}`, {\n                headers: {\n                  Authorization: `Bearer ${Authuser.access_token}`,\n                },\n              })\n\n              if(res.data.data.score){\n                this.setState({\n                  sessionData: {\n                    score: res.data.data.score\n                  },})\n              }\n\n          } catch (e) {\n            console.log(e);\n          }\n          }\n          fetchData();*/\n\n\n        if (Authuser.Role.role === 'Client') {\n\n          localStorage.setItem(\"User\", 'Client')\n          props.history.push(\"/dashboard\");\n        }\n        else if (Authuser.subRole === 'Super-admin') {\n\n          localStorage.setItem(\"SuperAdmin\", 'SuperAdmin')\n          props.history.push(\"/admin-dashboard\");\n        } else if (Authuser.Role.role === 'Admin') {\n          localStorage.setItem(\"Admin\", 'Admin')\n          props.history.push(\"/admindashboard\");\n        } else if (Authuser.Role.role === 'Writer') {\n\n          localStorage.setItem(\"Writer\", 'Writer')\n          props.history.push(\"/wexam\");\n          /*if (this.state.sessionData.score !== '') {\n            props.history.push(\"/wdashboard\");\n          }\n          else {\n            props.history.push(\"/wexam\");\n          }*/\n        }\n\n\n\n\n        return {};\n\n      })\n      .catch((e) => {\n        console.log(e);\n      });\n\n  };\n\n  // /auth/verify/{id}\n  verifyUser = (id,props) => {\n    console.log(\"my id first :\", id)\n    instance\n    .get(`${process.env.REACT_APP_DATABASEURL}auth/verify/${id}`)\n    .then((response) => {\n      const resStatus = response.data.status;\n        console.log(resStatus);\n        props.history.push(\"/login\");\n\n      return true;\n\n    })\n    .catch((e) => {\n      console.log(e);\n\n    });\n  }\n\n\n  registerUser = ({firstname, lastname,\n    phone,\n    email,\n    country,\n    password,\n    role}) => {\n    return new Promise((resolve, reject) => {\n\t\t// console.log({firstname, lastname,\n    //   phone,\n    //   email,\n    //   country,\n    //   password,\n    //   role})\n\t\tconst filterUserId = (resData) => {\n\t\t  var str = resData;\n\t\t  var res = str.replace(/\\D/g, \"\");\n\t\t  return res;\n\t\t}\n\n\t\tinstance\n\t\t.post(`${process.env.REACT_APP_DATABASEURL}auth/signup`,\n    {firstname: firstname, lastname: lastname,\n    phone:phone,\n    email:email,\n    country:country,\n    password:password,\n    role:role})\n\t\t.then((response) => {\n\t\t  const user = response.data;\n\t\t const verifyId =  filterUserId(user.data);\n\t\t  this.setState({\n\t\t\tsessionData: {\n\t\t\t  register:verifyId\n\t\t\t},});\n\t\t\tconsole.log(verifyId);\n\t\t  console.log(\"register response\",user)\n      console.log(resolve(response));\n\t\t  resolve(response);\n\n\t\t})\n\t\t.catch((e) => {\n\t\t  console.log(e);\n\t\t  reject(e);\n\t\t});\n\t} )\n  }\n\n\n  updateClientProfile = ({ firstName, lastName, phone, email, country },userId\n\n  ) =>  {\n    return new Promise((resolve, reject) => {\n    console.log(\"token preview\",firstName )\n\n    // console.log(\"this is update profile data received : \",{ firstName, lastName, phone, email, country },userId)\n    const token = localStorage.getItem(\"token\")\n    instance\n      .put(`${process.env.REACT_APP_DATABASEURL}user/${userId}`,\n        {\n          firstname : firstName,\n          lastname : lastName,\n          phone : phone,\n          email : email,\n          country : country\n        },\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        }\n      )\n      .then((data) => {\n        console.log(data);\n        console.log(\"Auth user\", localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY));\n        let x = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n        x = JSON.parse(x);\n        console.log(x);\n        x.first_name =firstName;\n        x.last_name = lastName;\n\n         localStorage.setItem(\n            'authUser',\n            JSON.stringify(x)\n          );\n        console.log(\"hitting updateclientProfile\");\n        console.log(data);\n        this.setState({\n          updatedProfile: !this.state.updatedProfile\n        })\n        resolve(data);\n      })\n      .catch((e) => {\n        console.log(e);\n        reject(e);\n      });\n  })}\n\n}\n\nexport { UserContainer };\n\n\n\n    // let user,copySessionData;\n    // console.log(\"check id \", this.state.userId);\n\n    // user = localStorage.getItem(LOCAL_STORAGE_SIGNIN_KEY);\n    // user = JSON.parse(user);\n    // copySessionData = ({}, this.state.sessionData);\n\n    // copySessionData.userId = user.id;\n    // this.setState({ sessionData: copySessionData });"]},"metadata":{},"sourceType":"module"}